<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wizbee - AI Word Puzzle Game</title>
    
    <!-- Google Sign-In -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

	@keyframes spin {
    	    from { transform: rotate(0deg); }
    	    to { transform: rotate(360deg); }
	}
	.loading { animation: spin 1s linear infinite; }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 800px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #f59e0b;
            font-size: 48px;
            margin-bottom: 30px;
        }

        /* Login Screen */
        .login-screen {
            text-align: center;
        }

        .login-screen h2 {
            font-size: 32px;
            margin-bottom: 20px;
            color: #333;
        }

        .login-screen p {
            font-size: 18px;
            margin-bottom: 30px;
            color: #666;
        }

        #google-signin-button {
            margin: 0 auto;
        }

        /* Screen 1 - Theme Input */
        .theme-input-screen {
            text-align: center;
        }

        .theme-input-screen h2 {
            font-size: 32px;
            margin-bottom: 30px;
            color: #333;
        }

        .theme-input-screen input {
            width: 100%;
            padding: 20px;
            font-size: 24px;
            border: 3px solid #667eea;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .theme-input-screen button {
            background: #667eea;
            color: white;
            border: none;
            padding: 20px 60px;
            font-size: 24px;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .theme-input-screen button:hover {
            background: #5568d3;
        }

        .user-info {
            text-align: center;
            margin-bottom: 20px;
            color: #666;
            font-size: 14px;
        }

        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
        }

        /* Screen 2 - Theme Selection */
        .theme-selection-screen {
            text-align: center;
        }

        .theme-selection-screen h2 {
            font-size: 32px;
            margin-bottom: 40px;
            color: #333;
        }

        .theme-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .theme-option {
            background: #f0f0f0;
            border: 3px solid #667eea;
            padding: 30px 20px;
            font-size: 24px;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            color: #333;
        }

        .theme-option:hover {
            background: #667eea;
            color: white;
            transform: translateY(-5px);
        }

        /* Screen 3 - Game Board */
        .game-screen {
            text-align: center;
        }

        .theme-display {
            font-size: 28px;
            margin-bottom: 30px;
            color: #667eea;
            font-weight: bold;
        }

        .word-boxes {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 30px;
        }

        .letter-box {
            width: 70px;
            height: 70px;
            border: 4px solid #333;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 42px;
            font-weight: bold;
            background: white;
        }

        .letter-box.small-font {
            width: 55px;
            height: 55px;
            font-size: 28px;
        }

        .letter-box.tiny-font {
            width: 45px;
            height: 45px;
            font-size: 22px;
        }

        .letter-box.correct {
            background: #6aaa64;
            color: #ffffff;
            border-color: #ffffff;
        }

        .letter-box.present {
            background: #f97316;
            color: white;
            border-color: #f97316;
        }

        .letter-box.absent {
            background: #787c7e;
            color: white;
            border-color: #787c7e;
        }

        @keyframes flash {
            0% { 
                transform: scale(1);
                filter: brightness(1);
            }
            25% { 
                transform: scale(1.3);
                filter: brightness(1.4) hue-rotate(90deg);
            }
            50% { 
                transform: scale(1.15);
                filter: brightness(1.6) hue-rotate(180deg);
            }
            75% { 
                transform: scale(1.3);
                filter: brightness(1.4) hue-rotate(270deg);
            }
            100% { 
                transform: scale(1);
                filter: brightness(1);
            }
        }

        .letter-box.flash {
            animation: flash 1s ease-in-out;
        }

        .letter-box.drag-over {
            background: #e0e0ff;
            border-color: #667eea;
            transform: scale(1.05);
        }

        .key.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .key {
            cursor: grab;
        }

        .guesses-remaining {
            font-size: 24px;
            margin-bottom: 30px;
            color: #333;
        }

        .keyboard {
            margin-bottom: 30px;
        }

        .keyboard-row {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .key {
            min-width: 50px;
            height: 60px;
            background: #d3d6da;
            border: none;
            border-radius: 8px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .key:hover {
            background: #bbbec2;
        }

        .key.used {
            background: #787c7e;
            color: white;
        }

        .key.correct {
            background: #6aaa64;
            color: white;
        }

        .key.present {
            background: #c9b458;
            color: white;
        }

        .guess-input-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: stretch;
            margin-bottom: 15px;
        }

	.hint-btn {
            background: #f59e0b;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
            transition: background 0.3s;
        }

        .hint-btn:hover {
            background: #d97706;
        }

        .hint-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .hint-display {
            background: #fff3cd;
            border: 2px solid #f59e0b;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            font-size: 18px;
            color: #333;
            line-height: 1.6;
        }

        .submit-guess, .give-up-btn {
            width: 250px;
            padding: 20px;
            font-size: 24px;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.3s;
            border: none;
            color: white;
        }

        .submit-guess {
            background: #667eea;
        }

        .submit-guess:hover {
            background: #5568d3;
        }

        .submit-guess:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .give-up-btn {
            background: #dc3545;
        }

        .give-up-btn:hover {
            background: #c82333;
        }

        .previous-guesses {
            margin-top: 30px;
        }

        .previous-guess {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .previous-guess .letter-box {
            width: 50px;
            height: 50px;
            font-size: 28px;
        }

        .previous-guess .letter-box.small-font {
            width: 40px;
            height: 40px;
            font-size: 20px;
        }

        .previous-guess .letter-box.tiny-font {
            width: 35px;
            height: 35px;
            font-size: 16px;
        }

        .message {
            font-size: 28px;
            margin: 20px 0;
            font-weight: bold;
        }

        .message.win {
            color: #6aaa64;
        }

        .message.lose {
            color: #dc3545;
        }

        .play-again {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 24px;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
	<h1><img src="bee.png" alt="Wizbee" style="height: 48px; vertical-align: middle;"> Wizbee</h1>

        <!-- Login Screen -->
        <div id="loginScreen" class="login-screen">
            <h2>Welcome to Wizbee!</h2>
            <p>Sign in with Google to play AI-powered word puzzles</p>
		<div style="display: flex; justify-content: center;">
    		<div id="google-signin-button"></div>
		</div>
        </div>

        <!-- Screen 1: Theme Input -->
        <div id="themeInputScreen" class="theme-input-screen hidden">
            <div class="user-info">
                Signed in as: <span id="userEmail"></span>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
            <h2>What theme would you like?</h2>
            <input type="text" id="themeInput" placeholder="Enter a theme (e.g., Italian Renaissance painters)">
            <button onclick="generateThemes()">Generate â†’</button>
        </div>

        <!-- Screen 2: Theme Selection -->
        <div id="themeSelectionScreen" class="theme-selection-screen hidden">
            <h2>Choose your theme:</h2>
            <div id="themeOptions" class="theme-options"></div>
        </div>

        <!-- Screen 3: Game Board -->
        <div id="gameScreen" class="game-screen hidden">
            <div class="theme-display">Theme: <span id="selectedTheme"></span></div>
            <div id="wordBoxes" class="word-boxes"></div>
            <div class="guesses-remaining">Guesses remaining: <span id="guessesRemaining"></span></div>
	    <div id="keyboard" class="keyboard"></div>
            
            <div class="guess-input-container">
                <button id="submitGuess" class="submit-guess" onclick="submitGuess()">Submit Word</button>
                <button id="giveUpBtn" class="give-up-btn" onclick="giveUp()">Give Up</button>
	    </div>
		<button id="hintBtn" class="hint-btn" onclick="getHint()">ðŸ’¡ Get Hint</button>
                     <div id="hintDisplay" class="hint-display hidden"></div>

            <div id="previousGuesses" class="previous-guesses"></div>
            <div id="gameMessage" class="message"></div>
            <button id="resetButton" class="play-again hidden" onclick="resetToTheme()">Reset</button>
        </div>
    </div>

    <script>
        // Your Railway backend URL
        const API_URL = 'https://wizbee-backend-production.up.railway.app';
        
        // Google Client ID - REPLACE WITH YOUR ACTUAL CLIENT ID
        const GOOGLE_CLIENT_ID = '635584185020-emmqudvevrf1j01lpu6nha4tfneju6t2.apps.googleusercontent.com';

        let authToken = null;
        let userEmail = null;
        let currentWord = '';
        let maxGuesses = 0;
        let remainingGuesses = 0;
        let currentGuess = '';
        let guessHistory = [];
        let gameOver = false;
        let selectedThemeWord = '';
	let hintsUsed = 0;
        const MAX_HINTS = 1;
        let currentLanguage = 'en';
	const keyboardLayouts = {
                  en: [
                        ['Q','W','E','R','T','Y','U','I','O','P'],
                        ['A','S','D','F','G','H','J','K','L'],
                        ['Z','X','C','V','B','N','M','âŒ«']
                        ],
                  fr: [ 
                        ['A','Z','E','R','T','Y','U','I','O','P'],
                        ['Q','S','D','F','G','H','J','K','L','M'],
                        ['W','X','C','V','B','N','Ã‰','Ãˆ','ÃŠ','Ã€','âŒ«']
                        ],
                  es: [
                        ['Q','W','E','R','T','Y','U','I','O','P'],
                        ['A','S','D','F','G','H','J','K','L','Ã‘'],
                        ['Z','X','C','V','B','N','M','Ã','Ã‰','Ã','Ã“','Ãš','âŒ«']
                        ]
                };

        // Initialize Google Sign-In
        window.onload = function() {
            // Check if already logged in
            authToken = localStorage.getItem('authToken');
            userEmail = localStorage.getItem('userEmail');
            
            if (authToken && userEmail) {
                showThemeInput();
            } else {
                google.accounts.id.initialize({
                    client_id: GOOGLE_CLIENT_ID,
                    callback: handleGoogleSignIn
                });
                
                google.accounts.id.renderButton(
                    document.getElementById('google-signin-button'),
                    { theme: 'outline', size: 'large', text: 'signin_with' }
                );
            }
        };

        // Handle Google Sign-In
        async function handleGoogleSignIn(response) {
            try {
                // Send the Google token to our backend
                const apiResponse = await fetch(`${API_URL}/auth/google`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: parseJwt(response.credential).email,
                        googleToken: response.credential
                    })
                });
                
                const data = await apiResponse.json();
                
                if (data.token) {
                    authToken = data.token;
                    userEmail = data.email;
                    
                    // Store in localStorage
                    localStorage.setItem('authToken', authToken);
                    localStorage.setItem('userEmail', userEmail);
                    
                    showThemeInput();
                } else {
                    alert('Authentication failed. Please try again.');
                }
            } catch (error) {
                console.error('Auth error:', error);
                alert('Authentication failed. Please try again.');
            }
        }

        // Parse JWT to get email
        function parseJwt(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }

	// Function create keyboard
	function createKeyboard(language) {
    		const container = document.getElementById('keyboard');
    		container.innerHTML = '';
    
    		const layout = keyboardLayouts[language] || keyboardLayouts['en'];
    
    		layout.forEach(row => {
        		const rowDiv = document.createElement('div');
        		rowDiv.className = 'keyboard-row';
        
        		row.forEach(letter => {
            			const key = document.createElement('button');
            			key.className = 'key';
            			key.textContent = letter;
            
            	if (letter === 'âŒ«') {
                	key.onclick = () => deleteLetter();
            	} else {
                	key.setAttribute('draggable', 'true');
                	key.onclick = () => addLetter(letter);
            	}
            
            		rowDiv.appendChild(key);
       		 });
        
        	container.appendChild(rowDiv);
    		});
	 }

        function showThemeInput() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('themeInputScreen').classList.remove('hidden');
            document.getElementById('userEmail').textContent = userEmail;
        }

        function logout() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('userEmail');
            authToken = null;
            userEmail = null;
            location.reload();
        }

        function generateThemes() {
            const input = document.getElementById('themeInput').value.trim();
            console.log('generateThemes called, input value:', input);
            
            if (!input) {
                alert('Please enter a theme!');
                return;
            }
            
            // Show theme selection screen immediately
            document.getElementById('themeInputScreen').classList.add('hidden');
            document.getElementById('themeSelectionScreen').classList.remove('hidden');
            
            const optionsContainer = document.getElementById('themeOptions');
            
            // Show single button to start game
            optionsContainer.innerHTML = '';
            const button = document.createElement('div');
            button.className = 'theme-option';
            button.textContent = `Generate puzzle for: ${input}`;
            
            // Capture input value before onclick
            const capturedTheme = input;
            console.log('Creating button with capturedTheme:', capturedTheme);
            
            button.onclick = function() {
                console.log('Button clicked! Captured theme:', capturedTheme);
                fetchAndStartGame(capturedTheme);
            };
            optionsContainer.appendChild(button);
        }

        async function fetchAndStartGame(theme) {
            console.log('fetchAndStartGame called with theme:', theme, 'type:', typeof theme);
            
            if (!theme) {
                alert('Error: No theme provided');
                return;
            }
            
            const optionsContainer = document.getElementById('themeOptions');
	    optionsContainer.innerHTML = '<div style="padding: 40px; text-align: center; font-size: 24px;"><img src="bee.png" class="loading" style="height: 40px; vertical-align: middle;"> Generating puzzle...</div>';
            
            try {
                console.log('Calling API with theme:', theme);
                
                const response = await fetch(`${API_URL}/api/generate-word`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`  // Add auth token
                    },
                    body: JSON.stringify({ theme: theme })
                });
                
                console.log('API response status:', response.status);
                const data = await response.json();
                console.log('API data:', data);

                if (data.error) {
                    alert(data.message || 'Failed to generate puzzle. Please try again.');
                    resetToTheme();
                    return;
                }

                // Start the game
                console.log('Starting game with word:', data.word);
                startGame(data);
                
            } catch (error) {
                console.error('API Error:', error);
                alert('Connection error: ' + error.message);
                resetToTheme();
            }
        }

        function startGame(gameData) {
            selectedThemeWord = gameData.theme;
            currentWord = gameData.word.toUpperCase();
            maxGuesses = gameData.guesses;
            remainingGuesses = maxGuesses;
	    currentLanguage = gameData.language || 'en';  // Easter Egg 
	    createKeyboard(currentLanguage);  // ADD THIS LINE
            
            // Show game screen
            document.getElementById('themeSelectionScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            document.getElementById('selectedTheme').textContent = selectedThemeWord;
            
            // Create word boxes
            createWordBoxes();
            updateGuessCount();
        }

        function createWordBoxes() {
            const container = document.getElementById('wordBoxes');
            container.innerHTML = '';
            
            // Determine font size based on word length
            let fontSizeClass = '';
            if (currentWord.length > 9) {
                fontSizeClass = 'tiny-font';
            } else if (currentWord.length > 6) {
                fontSizeClass = 'small-font';
            }
            
            for (let i = 0; i < currentWord.length; i++) {
                const box = document.createElement('div');
                box.className = `letter-box ${fontSizeClass}`;
                box.id = `box-${i}`;
                box.setAttribute('draggable', 'true');
                container.appendChild(box);
            }
        }

        function addLetter(letter) {
            if (gameOver) return;
            if (currentGuess.length < currentWord.length) {
                currentGuess += letter;
                updateCurrentGuessDisplay();
            }
        }

        function deleteLetter() {
            if (gameOver) return;
            currentGuess = currentGuess.slice(0, -1);
            updateCurrentGuessDisplay();
        }

        function updateCurrentGuessDisplay() {
            for (let i = 0; i < currentWord.length; i++) {
                const box = document.getElementById(`box-${i}`);
                if (i < currentGuess.length) {
                    box.textContent = currentGuess[i];
                } else {
                    box.textContent = '';
                }
            }
        }

        function submitGuess() {
            if (gameOver) return;
            
            const guess = currentGuess.toUpperCase();
            
            if (guess.length !== currentWord.length) {
                alert(`Please enter a ${currentWord.length}-letter word!`);
                return;
            }
            
            guessHistory.push(guess);
            remainingGuesses--;
            
            showGuessFeedback(guess);
            updateKeyboard(guess);
            
            if (guess === currentWord) {
                for (let i = 0; i < currentWord.length; i++) {
                    const box = document.getElementById(`box-${i}`);
                    box.textContent = currentWord[i];
                    box.classList.add('correct');
                }
                endGame(true);
            } else if (remainingGuesses === 0) {
                endGame(false);
            } else {
                currentGuess = '';
                updateCurrentGuessDisplay();
            }
            
            updateGuessCount();
        }

        function showGuessFeedback(guess) {
            const container = document.getElementById('previousGuesses');
            const guessDiv = document.createElement('div');
            guessDiv.className = 'previous-guess';
            
            const wordCopy = currentWord.split('');
            const guessCopy = guess.split('');
            const feedback = new Array(guess.length).fill('absent');
            
            for (let i = 0; i < guess.length; i++) {
                if (guess[i] === currentWord[i]) {
                    feedback[i] = 'correct';
                    wordCopy[i] = null;
                    guessCopy[i] = null;
                }
            }
            
            for (let i = 0; i < guess.length; i++) {
                if (guessCopy[i] !== null) {
                    const index = wordCopy.indexOf(guessCopy[i]);
                    if (index !== -1) {
                        feedback[i] = 'present';
                        wordCopy[index] = null;
                    }
                }
            }
            
            let fontSizeClass = '';
            if (currentWord.length > 9) {
                fontSizeClass = 'tiny-font';
            } else if (currentWord.length > 6) {
                fontSizeClass = 'small-font';
            }
            
            for (let i = 0; i < guess.length; i++) {
                const box = document.createElement('div');
                box.className = `letter-box ${feedback[i]} ${fontSizeClass}`;
                box.textContent = guess[i];
                guessDiv.appendChild(box);
            }
            
            container.appendChild(guessDiv);
        }

        function updateKeyboard(guess) {
            const wordCopy = currentWord.split('');
            
            for (let i = 0; i < guess.length; i++) {
                const letter = guess[i];
                const key = Array.from(document.querySelectorAll('.key')).find(k => k.textContent === letter);
                
                if (!key) continue;
                
                if (guess[i] === currentWord[i]) {
                    key.classList.add('correct');
                    key.classList.remove('present', 'used');
                } else if (wordCopy.includes(letter) && !key.classList.contains('correct')) {
                    key.classList.add('present');
                    key.classList.remove('used');
                } else if (!key.classList.contains('correct') && !key.classList.contains('present')) {
                    key.classList.add('used');
                }
            }
        }

        function updateGuessCount() {
            document.getElementById('guessesRemaining').textContent = remainingGuesses;
        }

        function endGame(won) {
            gameOver = true;
            const messageDiv = document.getElementById('gameMessage');
            const submitButton = document.getElementById('submitGuess');
            const giveUpButton = document.getElementById('giveUpBtn');
            const resetButton = document.getElementById('resetButton');
            
            submitButton.disabled = true;
            giveUpButton.classList.add('hidden');
            resetButton.classList.remove('hidden');
            
            if (won) {
                celebrateWin();
                messageDiv.textContent = `ðŸŽ‰ You won! The word was ${currentWord}`;
                messageDiv.className = 'message win';
            } else {
                messageDiv.textContent = `Game over! The word was ${currentWord}`;
                messageDiv.className = 'message lose';
            }
        }

        function celebrateWin() {
            for (let i = 0; i < currentWord.length; i++) {
                const box = document.getElementById(`box-${i}`);
                
                setTimeout(() => { box.classList.add('flash'); }, i * 150);
                setTimeout(() => { box.classList.remove('flash'); }, i * 150 + 1000);
                setTimeout(() => { box.classList.add('flash'); }, i * 150 + 1200);
                setTimeout(() => { box.classList.remove('flash'); }, i * 150 + 2200);
            }
        }

        function giveUp() {
            if (gameOver) return;
            endGame(false);
        }

	async function getHint() {
            if (gameOver) return;
            if (hintsUsed >= MAX_HINTS) {
                alert('You\'ve used all your hints for this puzzle!');
                return;
            }
            
            const hintBtn = document.getElementById('hintBtn');
            const hintDisplay = document.getElementById('hintDisplay');
            
            hintBtn.disabled = true;
            hintDisplay.textContent = 'ðŸ’¡ Generating hint...';
            hintDisplay.classList.remove('hidden');
            
            try {
                const response = await fetch(`${API_URL}/api/get-hint`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        word: currentWord,
                        theme: selectedThemeWord
                    })
                });
                
                const data = await response.json();
                
                if (data.hint) {
                    hintDisplay.textContent = 'ðŸ’¡ ' + data.hint;
                    hintsUsed++;
                    
                    if (hintsUsed >= MAX_HINTS) {
                        hintBtn.textContent = 'ðŸ’¡ No hints left';
                    } else {
                        hintBtn.disabled = false;
                        hintBtn.textContent = `ðŸ’¡ Get Hint (${MAX_HINTS - hintsUsed} left)`;
                    }
                } else {
                    throw new Error('No hint received');
                }
                
            } catch (error) {
                console.error('Hint error:', error);
                hintDisplay.textContent = 'âŒ Failed to generate hint. Try again!';
                hintBtn.disabled = false;
            }
        }

        function resetToTheme() {
            currentWord = '';
            maxGuesses = 0;
            remainingGuesses = 0;
            currentGuess = '';
            guessHistory = [];
            gameOver = false;
            selectedThemeWord = '';

	    hintsUsed = 0;
            document.getElementById('hintBtn').disabled = false;
            document.getElementById('hintBtn').textContent = 'ðŸ’¡ Get Hint';
            document.getElementById('hintDisplay').classList.add('hidden');
            
            document.getElementById('themeInput').value = '';
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('themeInputScreen').classList.remove('hidden');
            document.getElementById('previousGuesses').innerHTML = '';
            document.getElementById('gameMessage').textContent = '';
            document.getElementById('resetButton').classList.add('hidden');
            document.getElementById('giveUpBtn').classList.remove('hidden');
            document.getElementById('submitGuess').disabled = false;
            
            document.querySelectorAll('.key').forEach(key => {
                key.classList.remove('correct', 'present', 'used');
            });
        }

        // Keyboard input
        document.addEventListener('keydown', (e) => {
            if (gameOver) return;
            
            if (e.key === 'Enter') {
                submitGuess();
            } else if (e.key === 'Backspace') {
                deleteLetter();
            } else if (/^[a-zA-Z]$/.test(e.key)) {
                addLetter(e.key.toUpperCase());
            }
        });

        // Drag and drop (keeping from original)
        let draggedLetter = null;
        let dragSourceIndex = null;
        let dragSourceType = null;

        document.querySelectorAll('.key[draggable="true"]').forEach(key => {
            key.addEventListener('dragstart', (e) => {
                if (gameOver) {
                    e.preventDefault();
                    return;
                }
                draggedLetter = e.target.textContent;
                dragSourceType = 'keyboard';
                e.target.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'copy';
                e.dataTransfer.setData('text/plain', draggedLetter);
            });

            key.addEventListener('dragend', (e) => {
                e.target.classList.remove('dragging');
            });
        });

        document.getElementById('wordBoxes').addEventListener('dragstart', (e) => {
            if (gameOver) return;
            if (e.target.classList.contains('letter-box') && e.target.textContent.trim()) {
                draggedLetter = e.target.textContent;
                dragSourceType = 'box';
                dragSourceIndex = parseInt(e.target.id.split('-')[1]);
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/plain', draggedLetter);
                e.target.style.opacity = '0.5';
                e.target.classList.add('dragging');
            }
        }, true);

        document.getElementById('wordBoxes').addEventListener('dragend', (e) => {
            if (e.target.classList.contains('letter-box')) {
                e.target.style.opacity = '1';
                e.target.classList.remove('dragging');
            }
        }, true);

        document.getElementById('wordBoxes').addEventListener('dragover', (e) => {
            if (gameOver) return;
            if (e.target.classList.contains('letter-box')) {
                e.preventDefault();
                e.dataTransfer.dropEffect = dragSourceType === 'box' ? 'move' : 'copy';
                e.target.classList.add('drag-over');
            }
        }, true);

        document.getElementById('wordBoxes').addEventListener('dragleave', (e) => {
            if (e.target.classList.contains('letter-box')) {
                e.target.classList.remove('drag-over');
            }
        }, true);

        document.getElementById('wordBoxes').addEventListener('drop', (e) => {
            if (gameOver) return;
            if (!e.target.classList.contains('letter-box')) return;
            
            e.preventDefault();
            e.target.classList.remove('drag-over');
            
            const targetIndex = parseInt(e.target.id.split('-')[1]);
            
            if (dragSourceType === 'box' && dragSourceIndex !== null) {
                if (dragSourceIndex !== targetIndex) {
                    let guessArray = currentGuess.split('');
                    
                    if (targetIndex < guessArray.length && guessArray[targetIndex]) {
                        const temp = guessArray[targetIndex];
                        guessArray[targetIndex] = guessArray[dragSourceIndex];
                        guessArray[dragSourceIndex] = temp;
                    } else {
                        guessArray.splice(dragSourceIndex, 1);
                        
                        let adjustedTarget = targetIndex;
                        if (dragSourceIndex < targetIndex) {
                            adjustedTarget--;
                        }
                        
                        if (adjustedTarget >= guessArray.length) {
                            guessArray.push(draggedLetter);
                        } else {
                            guessArray.splice(adjustedTarget, 0, draggedLetter);
                        }
                    }
                    
                    currentGuess = guessArray.join('');
                    updateCurrentGuessDisplay();
                }
            } else if (dragSourceType === 'keyboard') {
                if (targetIndex === currentGuess.length && currentGuess.length < currentWord.length) {
                    addLetter(draggedLetter);
                } else if (targetIndex < currentGuess.length) {
                    let guessArray = currentGuess.split('');
                    guessArray[targetIndex] = draggedLetter;
                    currentGuess = guessArray.join('');
                    updateCurrentGuessDisplay();
                } else if (currentGuess.length < currentWord.length) {
                    addLetter(draggedLetter);
                }
            }
            
            dragSourceType = null;
            dragSourceIndex = null;
            draggedLetter = null;
        }, true);
    </script>
</body>
</html>
